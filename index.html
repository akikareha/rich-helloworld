<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rich Hello, World! (Vanilla JS)</title>
  <style>
    :root{
      --bg: #0b0d10;
      --card: #12151a;
      --text: #e8eef5;
      --muted: #9fb0c3;
      --accent: #4da3ff;
      --accent-2: #9ad1ff;
      --track: #1b2028;
      --ok: #72e06a;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; display:grid; place-items:center; min-height:100%;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 70% -10%, #1a2433 0%, transparent 60%), var(--bg);
      color:var(--text);
    }

    .wrap{ width:min(720px, 92vw); padding:28px; background:linear-gradient(180deg,#151a22,#101419); border:1px solid #202733; border-radius:var(--radius); box-shadow: var(--shadow); }
    .title{ margin:0 0 14px; font-size:clamp(20px, 3.5vw, 28px); letter-spacing:.02em; font-weight:700; transition: opacity .6s ease, transform .6s ease }
    .title.hide{ opacity:0; transform: translateY(-8px) }

    .loader{display:block; transition: opacity .6s ease, transform .6s ease}
    .loader.hide{opacity:0; transform: translateY(-8px)}

    .status{ display:flex; align-items:baseline; justify-content:space-between; gap:14px; margin-bottom:10px }
    .status .msg{ color:var(--muted); font-size:clamp(14px, 2.8vw, 16px); transition: opacity .35s ease, transform .35s ease; will-change: opacity, transform }
    .status .pct{ color:var(--accent-2); font-variant-numeric: tabular-nums; font-size:clamp(14px, 2.8vw, 16px) }

    .status .msg.switch{ opacity:0; transform: translateY(4px) }

    .bar{ position:relative; height:18px; background:var(--track); border-radius:999px; overflow:hidden; box-shadow: inset 0 1px 0 rgba(255,255,255,.04), inset 0 -1px 0 rgba(0,0,0,.5) }
    .bar .fill{
      position:absolute; inset:0; width:0%; height:100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      transition: width .18s ease;
    }
    .bar .shine{ position:absolute; inset:0; background:
      repeating-linear-gradient( 120deg, rgba(255,255,255,.12) 0 10px, transparent 10px 20px );
      mix-blend-mode: overlay; transform: translateX(0); animation: move 1.1s linear infinite; opacity:.35 }

    @keyframes move { to { transform: translateX(40px) } }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .bar .fill{ transition:none }
      .bar .shine{ animation:none }
      .loader{ transition: none }
    }

    .hello{ opacity:0; transform: translateY(12px); text-align:center; font-size: clamp(28px, 6vw, 56px); letter-spacing:.02em; margin:28px 0 6px; transition: opacity .7s ease, transform .7s ease }
    .hello.show{ opacity:1; transform: translateY(0) }
    .subtle{ text-align:center; color:var(--muted); margin-top: 6px; font-size: clamp(12px, 2.4vw, 14px) }
  </style>
</head>
<body>
  <div class="wrap">
    <h1 class="title">起動中…</h1>

    <!-- Loader -->
    <section id="loader" class="loader" aria-live="polite">
      <div class="status">
        <div id="statusText" class="msg" aria-live="polite" aria-atomic="true">読み込みを開始しています…</div>
        <div class="pct" id="percent" aria-hidden="true">0%</div>
      </div>
      <div class="bar" role="progressbar" aria-label="読み込みの進捗" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
        <div class="fill" id="fill">
          <div class="shine" aria-hidden="true"></div>
        </div>
      </div>
    </section>

    <!-- Final message -->
    <h2 id="hello" class="hello" hidden>Hello, World!</h2>
    <p id="helloSub" class="subtle" hidden>ようこそ。</p>
  </div>

  <script>
  // ===== Config (好みに合わせて調整できます) =====
  const MIN_DURATION_MS = 10000;     // 進捗が100%に達するまでの最短時間
  const MAX_DURATION_MS = 16000;     // 同 最長時間（ランダムで変化）
  const HOLD_AT_100_MS  = 1200;     // 100%になってから待たせる時間
  const STEP_INTERVAL_MS = 90;       // 進捗更新の間隔（短いほど滑らか）
  const MIN_MESSAGE_DWELL_MS = 1400; // メッセージの最小表示時間
  const MSG_FADE_MS = 250;           // メッセージ切り替えのフェード時間

  // i18n 設定（ブラウザ言語が ja* なら日本語、それ以外は英語）
  const LOCALE = (() => {
    const qs = new URLSearchParams(location.search);
    const forced = qs.get('lang');
    if (forced) return forced.toLowerCase().startsWith('ja') ? 'ja' : 'en';
    const langs = navigator.languages || [navigator.language || navigator.userLanguage];
    const lower = (langs || []).map(l => (l||'').toLowerCase());
    return lower.some(l => l.startsWith('ja')) ? 'ja' : 'en';
  })();

  const I18N = {
    ja: {
      title: '起動中…',
      ariaProgress: '読み込みの進捗',
      hello: 'こんにちは、世界！',
      helloSub: 'ようこそ。',
      messages: [
        { at: 0,   text: '読み込みを開始しています…' },
        { at: 10,  text: 'しばらくお待ちください…' },
        { at: 35,  text: 'データを準備中…' },
        { at: 60,  text: '最適化しています…' },
        { at: 80,  text: 'あと少しです…' },
        { at: 95,  text: 'まもなく完了します…' },
        { at: 100, text: '完了！' }
      ]
    },
    en: {
      title: 'Starting…',
      ariaProgress: 'Loading progress',
      hello: 'Hello, World!',
      helloSub: 'Welcome.',
      messages: [
        { at: 0,   text: 'Starting the loader…' },
        { at: 10,  text: 'Please wait…' },
        { at: 35,  text: 'Preparing data…' },
        { at: 60,  text: 'Optimizing…' },
        { at: 80,  text: 'Almost there…' },
        { at: 95,  text: 'Finishing up…' },
        { at: 100, text: 'Done!' }
      ]
    }
  };

  let MESSAGES = I18N[LOCALE].messages;

  // ===== DOM 参照 =====
  const loader = document.getElementById('loader');
  const fill   = document.getElementById('fill');
  const percentEl = document.getElementById('percent');
  const statusEl  = document.getElementById('statusText');
  const titleEl = document.querySelector('.title');
  const hello   = document.getElementById('hello');
  const helloSub = document.getElementById('helloSub');

  // 言語ごとの初期テキストをDOMに反映
  document.documentElement.lang = LOCALE;
  titleEl.textContent = I18N[LOCALE].title;
  statusEl.textContent = I18N[LOCALE].messages[0].text;
  document.querySelector('.bar').setAttribute('aria-label', I18N[LOCALE].ariaProgress);
  hello.textContent = I18N[LOCALE].hello;
  helloSub.textContent = I18N[LOCALE].helloSub;

  // ===== 進捗のシミュレーション =====
  let progress = 0; // 0..100
  let shownMsgIndex = -1;
  let lastMsgChange = 0;

  // 100%に到達するまでの目標時間（ランダムにして自然さを演出）
  const targetDuration = Math.floor(
    MIN_DURATION_MS + Math.random() * (MAX_DURATION_MS - MIN_DURATION_MS)
  );

  // 最後の方で失速させるためのしきい値
  const SLOWDOWN1 = 85;  // ここを超えると歩幅を狭く
  const SLOWDOWN2 = 95;  // さらに狭く

  const timer = setInterval(() => {
    // 残りに応じて歩幅（インクリメント幅）を可変に
    const remaining = 100 - progress;

    // 基本のステップ: 早め→遅め
    let step = Math.random() * 3 + 0.6; // 0.6〜3.6

    if (progress >= SLOWDOWN1 && progress < SLOWDOWN2) {
      step = Math.random() * 0.9 + 0.2; // 0.2〜1.1
    } else if (progress >= SLOWDOWN2) {
      step = Math.random() * 0.35 + 0.1; // 0.1〜0.45
    }

    // 全体の目標時間におおよそ合わせるよう、序盤は加速
    const elapsed = (performance.now() - window.__startTime);
    const ideal = (elapsed / targetDuration) * 100;
    if (ideal > progress && progress < 96) {
      // 目標より遅れていたら少し踏む
      step += (ideal - progress) * 0.04; // 調整係数
    }

    progress = Math.min(100, progress + Math.min(step, remaining));
    updateProgress(progress);

    if (progress >= 100) {
      clearInterval(timer);
      // 100%でも、あえて少し待たせる
      setTimeout(finish, HOLD_AT_100_MS);
    }
  }, STEP_INTERVAL_MS);

  // 開始時刻を記録
  window.__startTime = performance.now();

  function setMessage(text){
    statusEl.classList.add('switch');
    setTimeout(()=>{
      statusEl.textContent = text;
      statusEl.classList.remove('switch');
    }, MSG_FADE_MS);
  }

  function updateProgress(pct){
    fill.style.width = pct + '%';
    document.querySelector('.bar').setAttribute('aria-valuenow', Math.floor(pct));
    percentEl.textContent = Math.floor(pct) + '%';

    // メッセージ更新（最大の閾値を満たすもの）
    for (let i = MESSAGES.length - 1; i >= 0; i--){
      if (pct >= MESSAGES[i].at && shownMsgIndex !== i){
        const now = performance.now();
        if (now - lastMsgChange >= MIN_MESSAGE_DWELL_MS){
          shownMsgIndex = i;
          lastMsgChange = now;
          setMessage(MESSAGES[i].text);
        }
        break;
      }
    }
  }

  function finish(){
    // ローダーをフェードアウトしてから非表示に
    loader.classList.add('hide');
    loader.setAttribute('aria-hidden', 'true');
    titleEl.classList.add('hide');
    setTimeout(() => {
      loader.style.display = 'none';
      titleEl.style.display = 'none';
      // 「Hello, World!」をフェードイン
      hello.hidden = false; helloSub.hidden = false;
      requestAnimationFrame(() => {
        hello.classList.add('show');
      });
    }, 620);
  }
  </script>
</body>
</html>
